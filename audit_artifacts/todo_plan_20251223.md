# PhotoSearch v2 — Execution TODOs (2025-12-23)

This list translates current audit findings into actionable tasks. Keep evidence under `audit_artifacts/` for every verification.

## P0 (execute in order)

1) Desktop CSP runtime validation & tightening
   - Install Tauri CLI (`cargo install tauri-cli`) and ensure Rust toolchain is ready.
   - Build desktop: `cd ui && pnpm build`; then `cd src-tauri && cargo tauri build` (or `tauri dev` for interactive smoke).
   - Capture outputs: build logs + runtime smoke notes (ensure CSP doesn’t block app flows).
   - Tighten CSP after smoke: drop unneeded localhost origins for prod; plan to remove `'unsafe-inline'` once UI inline styles are cleaned.

2) Search mode semantics: Auto vs Manual
   - Decide contract: manual override disables auto-switching; add explicit UX toggle/state.
   - Update `PhotoSearchContext` and `DynamicNotchSearch` to honor the contract.
   - Add a small regression test (or story) to prevent mode flapping.

3) Bundle split warning cleanup
   - Resolve mixed static + dynamic imports for `IntentRecognition` (`MainRouter`, `EnhancedSearchUI`, `Search` page). Choose either fully lazy or fully static.
   - Re-run `pnpm build` and confirm the warning disappears; capture updated bundle stats.

4) Match explanations surfaced consistently
   - Standardize a reusable “Why this matched” component and wire it where explanations exist (backend: `server/utils/search_explanations.py`, UI types in `ui/src/api.ts`).
   - Add at least one UX surface per relevant search result type.

5) Audit truth maintenance
   - Re-run backend endpoint inventory against current decorators; refresh anchors in `audit_artifacts/backend_endpoint_inventory.md` and stats.

## P1 (next wave)

- Advanced OCR UX unification: single entry point + results surface for `/api/ocr/*` flows.
- Discovery/globe performance evidence: capture perf metrics and verify pin clustering/instancing.
- Frontend test posture: add vitest smoke path(s) + address `typescript-errors.txt` items.
- Accessibility gaps: add labels/aria for noted components (`FaceRecognitionPanel`, etc.).
- Style/lint hygiene: reduce inline styles in React components to enable CSP tightening later.

## Notes
- Existing evidence: `audit_artifacts/tauri_csp_enabled_20251223_233200.txt`, `audit_artifacts/tauri_cargo_check_20251223_233420.txt`, `audit_artifacts/tauri_csp_runtime_build_20251223.txt`.
- Keep adding artifacts per task (build logs, diffs, screenshots if relevant).

## Status snapshot (2025-12-23)
- Search mode manual override shipped in code; needs QA + UX sign-off in both Dynamic Notch/Dynamic Island and classic `/search` surfaces.
- Pending items (from board):
   - Desktop CSP runtime smoke test & tighten
   - Bundle split warning cleanup (IntentRecognition static/dynamic conflict)
   - Standardize match explanations UI
   - Advanced OCR UX unification
   - Discovery/globe performance evidence
   - Frontend test gate + smokes
